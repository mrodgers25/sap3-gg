{"ast":null,"code":"function _typeof(obj) { \"@babel/helpers - typeof\"; if (typeof Symbol === \"function\" && typeof Symbol.iterator === \"symbol\") { _typeof = function _typeof(obj) { return typeof obj; }; } else { _typeof = function _typeof(obj) { return obj && typeof Symbol === \"function\" && obj.constructor === Symbol && obj !== Symbol.prototype ? \"symbol\" : typeof obj; }; } return _typeof(obj); }\n\nimport { find as t, findOne as e, on as o } from \"domassist\";\nimport i from \"attrobj\";\nimport n from \"aug\";\n\nfunction s(t) {\n  return t.parentNode ? JSON.parse(JSON.stringify(t.parentNode.dataset)).module ? t.parentNode : s(t.parentNode) : t;\n}\n\nvar r = {\n  find: t,\n  findOne: e,\n  on: o\n},\n    d = function () {\n  function t(e, o) {\n    return void 0 === o && (o = \"\"), this.log(\"begin setup\"), this.el = e, this.els = {}, this.options = n({}, this.defaults, i(\"module\", this.el)), this.moduleName = o || this.el.dataset.module, this.setUps = {\n      actions: [],\n      named: [],\n      options: []\n    }, this.boundActionRouter = this.actionRouter.bind(this), this.preInit(), this.storeRef(), this.setupActions(), this.setupNamed(), this.verifyRequired(), this.postInit(), this.log(\"initalized\"), t.debug && (this.el.module = this), this;\n  }\n\n  var e,\n      o = t.prototype;\n  return o.preInit = function () {}, o.postInit = function () {}, o.verifyRequired = function () {\n    var t = this;\n    return this.required === {} || (void 0 !== this.required.options && (this.setUps.options = Object.keys(this.options)), Object.keys(this.required).forEach(function (e) {\n      t.required[e].forEach(function (o) {\n        if (t.setUps[e].indexOf(o) < 0) throw new Error(o + \" is required as \" + e + \" for \" + t.moduleName + \", but is missing!\");\n      });\n    })), this;\n  }, o.setupActions = function () {\n    var t = this;\n    this.setupAction(this.el), this.find(\"[data-action]\").forEach(function (e) {\n      s(e) === t.el && t.setupAction(e);\n    });\n  }, o.setupAction = function (e) {\n    if (\"true\" !== e.dataset.domoduleActionProcessed) {\n      var o = t.parseAction(e),\n          i = o.name,\n          n = o.type;\n      i && (\"function\" == typeof this[i] ? (this.log(i + \" bound\"), this.storeSetUp(i, \"actions\"), r.on(e, n, this.boundActionRouter), e.dataset.domoduleActionProcessed = \"true\") : this.log(i + \" was registered, but there is no function set up\"));\n    }\n  }, o.actionRouter = function (e) {\n    var o = e.currentTarget,\n        n = t.parseAction(o).name,\n        s = i(\"action\", o);\n    this[n].call(this, o, e, s);\n  }, o.setupNamed = function () {\n    var t = this;\n    this.find(\"[data-name]\").forEach(function (e) {\n      s(e) === t.el && (e.dataset.domoduleNameProcessed || (t.els[e.dataset.name] = e, t.storeSetUp(e.dataset.name, \"named\"), e.dataset.domoduleNameProcessed = \"true\", e.dataset.domoduleOwner = t.id));\n    });\n  }, o.storeRef = function () {\n    if (void 0 === window.domorefs && (window.domorefs = {}), void 0 !== window.domorefs[this.el.dataset.moduleUid]) return !1;\n    this.id = this.uuid, this.el.dataset.moduleUid = this.id, window.domorefs[this.el.dataset.moduleUid] = this;\n  }, o.find = function (t) {\n    return r.find(t, this.el);\n  }, o.findOne = function (t) {\n    return r.findOne(t, this.el);\n  }, o.findByName = function (t) {\n    return this.els[t];\n  }, o.getOption = function (t) {\n    return this.options[t];\n  }, o.storeSetUp = function (t, e) {\n    this.setUps[e].indexOf(t) < 0 && this.setUps[e].push(t);\n  }, o.destroy = function () {\n    var e = this;\n    r.find(\"[data-action]\", this.el.parentNode).forEach(function (o) {\n      if (\"true\" === o.dataset.domoduleActionProcessed) {\n        var i = t.parseAction(o);\n        o.removeEventListener(i.type, e.boundActionRouter), o.dataset.domoduleActionProcessed = \"false\";\n      }\n    });\n  }, t.parseAction = function (t) {\n    var e = t.dataset,\n        o = e.actionType;\n    return {\n      name: e.action,\n      type: void 0 === o ? \"click\" : o\n    };\n  }, t.getInstance = function (t) {\n    if (t instanceof Node) return window.domorefs[t.dataset.moduleUid];\n    throw new Error(\"getInstance expects a dom node\");\n  }, t.register = function (e, o) {\n    \"function\" == typeof e && (e = (o = e).prototype.constructor.name), window.domodules || (window.domodules = {}), t.log(\"Registering \" + e), window.domodules[e] = o;\n  }, t.discover = function (e) {\n    if (void 0 === e && (e = \"body\"), t.log(\"Discovering modules...\"), window.domodules) {\n      var o;\n      o = e instanceof Node ? [e] : Array.isArray(e) ? e : r.find(e);\n      var i = [];\n      return o.forEach(function (e) {\n        r.find(\"[data-module]\", e).forEach(function (e) {\n          var o = e.dataset.module;\n\n          if (o && \"function\" == typeof window.domodules[o]) {\n            if (\"object\" == _typeof(window.domorefs) && void 0 !== window.domorefs[e.dataset.moduleUid]) return;\n            t.log(o + \" found\"), i.push(new window.domodules[o](e));\n          }\n        });\n      }), i;\n    }\n\n    t.log(\"No modules found\");\n  }, o.log = function (e) {\n    t.log(this.constructor.name + \": \" + e);\n  }, t.log = function (e) {\n    t.debug && console.log(\"[DOMODULE] \" + e);\n  }, (e = [{\n    key: \"required\",\n    get: function get() {\n      return {};\n    }\n  }, {\n    key: \"defaults\",\n    get: function get() {\n      return {};\n    }\n  }, {\n    key: \"uuid\",\n    get: function get() {\n      return \"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx\".replace(/[xy]/g, function (t) {\n        var e = 16 * Math.random() | 0;\n        return (\"x\" === t ? e : 3 & e | 8).toString(16);\n      });\n    }\n  }]) && function (t, e) {\n    for (var o = 0; o < e.length; o++) {\n      var i = e[o];\n      i.enumerable = i.enumerable || !1, i.configurable = !0, \"value\" in i && (i.writable = !0), Object.defineProperty(t, i.key, i);\n    }\n  }(t.prototype, e), t;\n}();\n\nd.debug = \"object\" == _typeof(window.localStorage) && window.localStorage.getItem(\"DomoduleDebug\"), d.autoDiscover = !0, window.addEventListener(\"DOMContentLoaded\", function () {\n  d.autoDiscover && d.discover();\n});\nexport default d;","map":null,"metadata":{},"sourceType":"module"}